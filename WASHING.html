<!DOCTYPE html>
<html>
<head>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-database.js"></script>
    <title>Laundry Booking System</title>
    <style>
        body { font-family: Arial, sans-serif; text-align: center; }
        .container { max-width: 600px; margin: auto; padding: 20px; border: 1px solid #ccc; border-radius: 10px; }
        select, button { margin: 10px; padding: 10px; width: 100%; }
        table { width: 100%; margin-top: 20px; border-collapse: collapse; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: center; }
        th { background: #f4f4f4; }
        .admin-btn { background-color: #4CAF50; color: white; }
        .admin-section { display: none; padding: 20px; background: #f9f9f9; margin-top: 20px; border-radius: 10px; border: 1px solid #ccc; }
        .admin-table { margin-top: 20px; width: 100%; }
        .admin-table th, .admin-table td { padding: 10px; text-align: center; }
        .delete-btn { color: red; cursor: pointer; }
    </style>
</head>
<body>
    <div class="container">
        <h2>Washing Machine & Dryer Booking</h2>
        <label>Select Date:</label>
        <input type="date" id="date">
        
        <label>Select Start Time:</label>
        <select id="startTime"></select>
        
        <label>Select Machine Type:</label>
        <select id="machineType" onchange="updateMachineNumbers()">
            <option value="Washer">Washer (1.5 hrs)</option>
            <option value="Dryer">Dryer (1 hr)</option>
        </select>
        
        <label>Select Machine Number:</label>
        <select id="machineNumber"></select>
        
        <button onclick="bookSlot()">Book Slot</button>
        
        <h3>Booked Slots</h3>
        <table>
            <tr>
                <th>Name</th>
                <th>Date</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Machine</th>
                <th>Number</th>
                <th>Status</th>
                <th>Action</th>
            </tr>
            <tbody id="bookingList"></tbody>
        </table>

        <button class="admin-btn" onclick="showAdminPanel()">Admin Panel</button>
        
        <div class="admin-section" id="adminSection">
            <h3>Admin Panel</h3>
            <label>Enter Admin Password:</label>
            <input type="password" id="adminPassword" placeholder="Admin Password">
            <button onclick="authenticateAdmin()">Submit</button>
            
            <h3>Manage Bookings</h3>
            <table class="admin-table">
                <thead>
                    <tr>
                        <th>Name</th>
                        <th>Date</th>
                        <th>Start Time</th>
                        <th>End Time</th>
                        <th>Machine</th>
                        <th>Number</th>
                        <th>Action</th>
                    </tr>
                </thead>
                <tbody id="adminBookingList"></tbody>
            </table>
        </div>
    </div>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "YOUR_API_KEY",
            authDomain: "YOUR_PROJECT_ID.firebaseapp.com",
            databaseURL: "https://YOUR_PROJECT_ID.firebaseio.com",
            projectId: "YOUR_PROJECT_ID",
            storageBucket: "YOUR_PROJECT_ID.appspot.com",
            messagingSenderId: "YOUR_MESSAGING_SENDER_ID",
            appId: "YOUR_APP_ID",
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const adminPassword = 'admin123';

        // Show machine numbers based on selected machine type
        function updateMachineNumbers() {
            let machineType = document.getElementById('machineType').value;
            let machineNumberSelect = document.getElementById('machineNumber');
            machineNumberSelect.innerHTML = '';  // Clear previous options
            let machineCount = (machineType === 'Washer') ? 4 : 3;  // Set machine count based on type

            // Populate machine numbers dropdown
            for (let i = 1; i <= machineCount; i++) {
                let option = document.createElement('option');
                option.value = i;
                option.textContent = `Machine ${i}`;
                machineNumberSelect.appendChild(option);
            }

            // Update start time options based on machine type
            let startTimeSelect = document.getElementById('startTime');
            startTimeSelect.innerHTML = '';  // Clear previous options

            let slots = (machineType === 'Washer') ? ['00:00', '01:30', '03:00', '04:30', '06:00', '07:30', '09:00', '10:30', '12:00', '13:30', '15:00', '16:30', '18:00', '19:30', '21:00', '22:30'] :
                            ['00:00', '01:00', '02:00', '03:00', '04:00', '05:00', '06:00', '07:00', '08:00', '09:00', '10:00', '11:00', '12:00', '13:00', '14:00', '15:00', '16:00', '17:00', '18:00', '19:00', '20:00', '21:00', '22:00'];

            // Populate start time dropdown
            slots.forEach(slot => {
                let option = document.createElement('option');
                option.value = slot;
                option.textContent = slot;
                startTimeSelect.appendChild(option);
            });
        }

        // Book a slot
        function bookSlot() {
            let name = prompt("Enter your name:");
            let date = document.getElementById('date').value;
            let startTime = document.getElementById('startTime').value;
            let machineType = document.getElementById('machineType').value;
            let machineNumber = document.getElementById('machineNumber').value;

            if (!name || !date || !startTime || !machineType || !machineNumber) {
                alert("All fields are required!");
                return;
            }

            let bookingKey = `${date}_${startTime}_${machineType}_${machineNumber}`;

            // Check if the slot is already booked
            db.ref("bookings/" + bookingKey).once("value", (snapshot) => {
                if (snapshot.exists()) {
                    alert("Slot already booked!");
                } else {
                    db.ref("bookings/" + bookingKey).set({
                        name: name,
                        date: date,
                        startTime: startTime,
                        machineType: machineType,
                        machineNumber: machineNumber
                    }).then(() => {
                        alert("Booking successful!");
                        displayBookings(); // Display the bookings after successful booking
                    }).catch((error) => {
                        alert("Error booking slot: " + error.message);
                    });
                }
            });
        }

        // Display bookings
        function displayBookings() {
            db.ref("bookings").once("value", (snapshot) => {
                let bookings = snapshot.val();
                let table = document.getElementById('bookingList');
                table.innerHTML = ''; // Clear previous data

                for (let key in bookings) {
                    let booking = bookings[key];
                    let endTime = getEndTime(booking.startTime, booking.machineType);
                    let row = `<tr><td>${booking.name}</td><td>${booking.date}</td><td>${booking.startTime}</td><td>${endTime}</td><td>${booking.machineType}</td><td>${booking.machineNumber}</td><td>Booked</td><td><button class="delete-btn" onclick="deleteBooking('${key}')">Delete</button></td></tr>`;
                    table.innerHTML += row;
                }
            });
        }

        // Get end time based on machine type and start time
        function getEndTime(startTime, machineType) {
            let start = startTime.split(':');
            let hours = parseInt(start[0]);
            let minutes = parseInt(start[1]);

            if (machineType === 'Washer') {
                minutes += 90; // Washer runs for 1.5 hours
            } else {
                minutes += 60; // Dryer runs for 1 hour
            }

            if (minutes >= 60) {
                hours += Math.floor(minutes / 60);
                minutes = minutes % 60;
            }

            return `${hours.toString().padStart(2, '0')}:${minutes.toString().padStart(2, '0')}`;
        }

        // Delete booking
        function deleteBooking(key) {
            db.ref("bookings/" + key).remove()
                .then(() => {
                    alert("Booking deleted successfully!");
                    displayBookings(); // Re-load bookings after deletion
                })
                .catch(error => {
                    alert("Error deleting booking: " + error.message);
                });
        }

        // Admin Panel: Show the panel for managing bookings
        function showAdminPanel() {
            document.getElementById('adminSection').style.display = 'block';
        }

        // Authenticate Admin
        function authenticateAdmin() {
            let enteredPassword = document.getElementById('adminPassword').value;
            if (enteredPassword === adminPassword) {
                loadAdminBookings();
            } else {
                alert('Incorrect password!');
            }
        }

        // Load all bookings for admin to manage
        function loadAdminBookings() {
            db.ref("bookings").once("value", (snapshot) => {
                let bookings = snapshot.val();
                let table = document.getElementById('adminBookingList');
                table.innerHTML = '';

                for (let key in bookings) {
                    let booking = bookings[key];
                    let endTime = getEndTime(booking.startTime, booking.machineType);
                    let row = `<tr><td>${booking.name}</td><td>${booking.date}</td><td>${booking.startTime}</td><td>${endTime}</td><td>${booking.machineType}</td><td>${booking.machineNumber}</td><td><button class="delete-btn" onclick="deleteBooking('${key}')">Delete</button></td></tr>`;
                    table.innerHTML += row;
                }
            });
        }

        // Initialize machine numbers and load bookings from Firebase
        updateMachineNumbers();
        displayBookings();
    </script>
</body>
</html>
